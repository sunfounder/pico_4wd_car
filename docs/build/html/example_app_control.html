

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>APP Control &mdash; SunFounder pico_4wd_car  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://ezblock.cc/readDocFile/topHead.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="https://ezblock.cc/readDocFile/topHead.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SunFounder pico_4wd_car
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="introduce.html">Introduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_start/get_start.html">Get Started with MicroPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_the_modules.html">Test the Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="assemble_the_car.html">Assemble the Car</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Micropython Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="app/app_control.html">APP Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax/micropython_basic_syntax.html">(Optional) MicroPython Basic Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="thank-robot.html">Thank You</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SunFounder pico_4wd_car</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>APP Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/example_app_control.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="app-control">
<h1>APP Control<a class="headerlink" href="#app-control" title="Permalink to this headline">¶</a></h1>
<p>This section will guide you to use Sunfounder Controller APP to play pico-4wd remotely, which means you can use your phone/tablet to control it wandering around outdoors.</p>
<div class="section" id="how-to-do">
<h2>How to do?<a class="headerlink" href="#how-to-do" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Coding</p>
<blockquote>
<div><p>To make things easier, let’s use <code class="docutils literal notranslate"><span class="pre">app_test.py</span></code> in the <strong>tests</strong> folder (this code will be explained later) for the first Sunfounder Controller experiment!</p>
<p>After running the program (Pico RDP should also be working at this time), Pico-4wd does not show anything, while the Thonny script shows the following message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Install Sunfounder Controller</p>
<blockquote>
<div><p>Search for <strong>Sunfounder Controller</strong> in APP Store (or Google Play) and download it.</p>
<img alt="img/app_install.png" src="img/app_install.png" />
</div></blockquote>
</li>
<li><p>Connect to mobile devices.</p>
<blockquote>
<div><p>Find <strong>my_4wd_car</strong> on the WLAN of the mobile phone (tablet), enter the password (12345678) and connect to it. This is an <code class="docutils literal notranslate"><span class="pre">AP</span></code> released by Pico RDP and is not connected to the World Wide Web.</p>
<p>If you need to keep the phone (tablet) network, you can switch to <code class="docutils literal notranslate"><span class="pre">STA</span></code> mode, which will be discussed later.</p>
<p>After the connection is successful, the Thonny script will show the IP of the newly connected device:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
<span class="hll">    Connected from 192.168.4.3
</span></pre></div>
</div>
</div></blockquote>
</li>
<li><p>Open <strong>Sunfounder Controller</strong> , and you will see the home page，click the <strong>connect</strong> icon on the top right corner to complete the connection between Pico-4wd and the phone (tablet).</p>
<blockquote>
<div><img alt="img/app_home_page.jpg" src="img/app_home_page.jpg" />
<ul class="simple">
<li><p>The big <strong>plus</strong> button in the middle can create a controller, and you can create multiple controller schemes in Sunfounder Controller.</p></li>
<li><p>Click on the <strong>exclamation mark</strong> icon in the upper left corner to view “ABOUT US”</p></li>
<li><p>The red letter on the upper right shows the current connection status of Sunfounder Controller. If it is connected to a device (such as Pico-4wd), it will become a white font.</p></li>
<li><p>The <strong>edit</strong> icon allows you to delete redundant controllers.</p></li>
<li><p>You will need to click the <strong>link</strong> icon at the top right to connect to the mobile device. It should be noted that the Sunfounder Controller can connect successfully only when the device is running the program (you will need to reconnect after re-burning the code).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Create a controller, you will be able to see boxes (some are rectangles, some are squares), we need to adjust them to apply to <code class="docutils literal notranslate"><span class="pre">app_test.py</span></code>.</p>
<blockquote>
<div><img alt="img/app_test_controller_1.jpg" src="img/app_test_controller_1.jpg" />
<p>Click on area D and select the <strong>radar scanning</strong> widget.</p>
<img alt="img/app_test_controller_2.jpg" src="img/app_test_controller_2.jpg" />
<p>Click on area H and sclect the <strong>Slider</strong> widget。</p>
<img alt="img/app_test_controller_3.jpg" src="img/app_test_controller_3.jpg" />
<p>Click the <strong>save</strong> icon at the top right, and the controller will be saved. At the same time it enters the working state, and the empty widget box is hidden.</p>
<p>At this time, the original <strong>save</strong> icon will become an <strong>edit</strong> icon, click on it to return to the edit state to adjust the widget.</p>
<img alt="img/app_test_controller_4.jpg" src="img/app_test_controller_4.jpg" />
</div></blockquote>
</li>
<li><p>Click the run icon next to the edit icon, Pico-4wd finally starts to move！</p>
<blockquote>
<div><p>If it fails to proceed as expected, or <strong>Disconnected</strong> is displayed next to the <strong>Run</strong> icon, please reconnect the Pico-4wd to the phone (tablet), and try again!</p>
<ul class="simple">
<li><p>You will be able to see that the Pico-4wd radar is scanning, and the D box on the Sunfounder Controller will show the scan results.</p></li>
<li><p>If you flip the slider of the H box, the RGB Board at the rear of the car will lights up the corresponding lights.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="how-it-works">
<h2>How it works?<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>The communication between Pico-4wd and Sunfounder Controller is based on the <code class="docutils literal notranslate"><span class="pre">websocket</span> <span class="pre">protocol</span></code>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/WebSocket">WebSocket - Wikipedia</a></p></li>
</ul>
<p>Its function has been written in <code class="docutils literal notranslate"><span class="pre">ws.py</span></code>, we have loaded it in the chapter <span class="xref std std-ref">Import Pico-4wd Libraries</span>.</p>
<p>The specific workflow of APP Control gameplay is as follows:</p>
<a class="reference internal image-reference" href="_images/flowchart_app_control1.png"><img alt="_images/flowchart_app_control1.png" src="_images/flowchart_app_control1.png" style="width: 500px;" /></a>
<p><strong>Code</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ws</span> <span class="kn">import</span> <span class="n">WS_Server</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pico_4wd</span> <span class="k">as</span> <span class="nn">car</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="c1">## Client Mode</span>
<span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
<span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
<span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>

<span class="c1">## AP Mode</span>
<span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="k">pass</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>
</pre></div>
</div>
<p>This code constitutes the basic framework of APP control. Here, you need to pay attention to the following two parts:</p>
<ol class="arabic">
<li><p>Setup websocket</p>
<blockquote>
<div><p>There are two connection mode between Sunfounder Controller and Pico-4wd car: One is <strong>AP</strong> mode, the other is <strong>STA</strong> mode.</p>
<ul class="simple">
<li><p><strong>AP Mode</strong>: You need to connect Sunfounder Contorller to the hotspot released by Pico-4wd car.</p></li>
<li><p><strong>STA Mode</strong>: You need to connect Sunfounder Controller and Pico-4wd car to the same LAN.</p></li>
</ul>
<p>The default connection mode is <strong>AP Mode</strong>: The car releases the hotspot (the Wifi name is <code class="docutils literal notranslate"><span class="pre">NAME</span></code> in the code, here is <code class="docutils literal notranslate"><span class="pre">my_4wd_car</span></code>), the mobile phone (tablet) is connected to this WLAN.
This mode allows you to remotely control Pico-4wd in any situation, but will make your phone (tablet) temporarily unable to connect to the Internet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also use <strong>STA</strong> mode: Let Pico-4wd car connects to your home WLAN, and your mobile phone (tablet) should also be connected to the same WLAN.</p>
<p>This mode is opposite to the <strong>AP</strong> mode and will not affect the normal use of the mobile phone (tablet), but will limit your Pico-4wd car from leaving the WLAN radiation range.</p>
<p>The way to start this mode is to comment out the three lines under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">AP</span> <span class="pre">Mode</span></code>, uncomment the three lines under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Client</span> <span class="pre">Mode</span></code>, and change the SSID and PASSWORD to your home WIFI at the same time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;sta&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;Sunfounder&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;ap&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>After completing the connection mode settings, Websocket will set up and start the server.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Responding</p>
<blockquote>
<div><p>The specific operation code of Pico-4wd and Sunfounder Controller is written on the <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> function. Usually, we need to write the codes for APP to control Pico-4wd on the front and the codes for APP to show Pico-4wd sensor data on the back.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="k">pass</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>
</pre></div>
</div>
<p>As shown below, we have written the controls code for the H area slider to control the number of lights on the RGB Board; and the sensor codes for the D area to show the radar detection results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> will be assigned to <code class="docutils literal notranslate"><span class="pre">ws.on_receive</span></code> and then called by <code class="docutils literal notranslate"><span class="pre">ws.loop</span></code>.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="transfer-data">
<h2>Transfer Data<a class="headerlink" href="#transfer-data" title="Permalink to this headline">¶</a></h2>
<p><strong>From APP to Pico-4wd</strong></p>
<blockquote>
<div><p>Let’s take a look at what kind of data Pico-4wd will get from the APP. Print <code class="docutils literal notranslate"><span class="pre">data</span></code> directly in <code class="docutils literal notranslate"><span class="pre">on_receive</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>You will be able to see the following string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;J_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;A_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;L_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;K_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;F_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;M_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;H_region&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;Q_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;G_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;I_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;B_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;D_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;C_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;N_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;E_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;P_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;O_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<p>As we can see, the value of H Box is 50 (<code class="docutils literal notranslate"><span class="pre">H_region':</span> <span class="pre">50</span></code>), and the others are None. This is because we only add one control widget (H Box). The widget in the D area is not used for control but only for show.</p>
<p>We can also add other control widgets, and use the same method to view the values ​​sent by these widgets to Pico-4wd.</p>
<p>You can get the value of the corresponding widget by just using the label. As shown below, print the value of the H Box widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
    Connected from 192.168.4.3
    50
    50
    50
</pre></div>
</div>
<p>As shown below, use the obtained H Box widget (Slider) value to control the RGB Board at the rear of the car.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>
</pre></div>
</div>
<p>You can use <a class="reference external" href="https://github.com/sunfounder/pico_4wd_car/blob/main/api_reference_pico_4wd.md">API</a> file to help you understand the functions in the code.</p>
</div></blockquote>
<p><strong>From Pico-4wd to APP</strong></p>
<blockquote>
<div><p>Now let’s see what kind of data Pico-4wd will send to the APP. The following code is used to obtain the ultrasonic detection distance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
    Connected from 192.168.4.2
    [-10, 49.249]
    [-20, 37.417]
    [-30, 38.947]
    [-40, 36.193]
    [-50, 40.12]
    [-60, 36.431]
</pre></div>
</div>
<p>You can use <a class="reference external" href="https://github.com/sunfounder/pico_4wd_car/blob/main/api_reference_pico_4wd.md">API</a> file to help you understand the functions in the code.</p>
<p>Now use the <code class="docutils literal notranslate"><span class="pre">send_dict</span></code> function to show the distance value in D Widget.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="app-control-example">
<h2>APP Control Example<a class="headerlink" href="#app-control-example" title="Permalink to this headline">¶</a></h2>
<p>Now, please open de <code class="docutils literal notranslate"><span class="pre">app_control.py</span></code> in <strong>examples</strong> and try the complete APP remote control gameplay!</p>
<img alt="img/app_control_example.jpg" src="img/app_control_example.jpg" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ws</span> <span class="kn">import</span> <span class="n">WS_Server</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pico_4wd</span> <span class="k">as</span> <span class="nn">car</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_pico_car&#39;</span>

<span class="c1"># Client Mode</span>
<span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
<span class="c1"># SSID = &quot;YOUR_SSID_HERE&quot;</span>
<span class="c1"># PASSWORD = &quot;YOUR_PASSWORD_HERE&quot;</span>

<span class="c1"># AP Mode</span>
<span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">led_status</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">led_status</span>

    <span class="c1">#Move</span>
    <span class="k">if</span> <span class="s1">&#39;K_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;H_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># print(data[&#39;K_region&#39;])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>

        <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>

    <span class="c1"># RGB LED</span>
    <span class="k">if</span> <span class="s1">&#39;M_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">led_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M_region&#39;</span><span class="p">]</span>

    <span class="c1"># speed measurement</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;A_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">speed</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">led_status</span><span class="p">:</span>
        <span class="c1"># HUE color system, Red is 0, and Green is 120</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">speed</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">hue2rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">)</span>
        <span class="n">car</span><span class="o">.</span><span class="n">set_light_bottom_color</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>

    <span class="c1"># radar</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>

    <span class="c1"># greyscale</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_values</span><span class="p">()</span>


<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="widget-list">
<h2>Widget List<a class="headerlink" href="#widget-list" title="Permalink to this headline">¶</a></h2>
<p>The control widgets are shown in the table:</p>
<img alt="img/app_widget_control.png" src="img/app_widget_control.png" />
<p>The data widgets are shown in the table:</p>
<img alt="img/app_widget_display.png" src="img/app_widget_display.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SunFounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>